
# 设计模式

### 1、设计模式是什么？简要概述

> 设计模式是一种编码经验，用比较成熟的逻辑去处理某一种类型的事情；
>
> 1. MVC 模式：model、view、control，把模型、视图、控制器进行解耦；
> 2. MVVM 模式：在 MVC 的基础上增加 viewmodel 层，把模型、视图和业务逻辑进行解耦；
> 3. 单例模式：通过 static 关键字，声明全局变量，在整个进程运行期间只会被赋值一次；
> 4. 观察者模式： KVO 是典型的通知模式，观察某个属性的状态，状态发生变化时，通知观察者；
> 5. 委托模式：代理 + 协议的组合，实现 1 对 1 的方向传值操作；
> 6. 工厂模式： 通过一个类方法，批量的根据已有的模版生产对象。

### 2、 比较 MVC 和 MVVM

> * 模型层几乎相同：模型层从理论上来说都是数据来源
> * 视图层在理论上都被设计为被动，但是实际上略有不同：在实际的开发中，MVC 的视图层和中间层高度耦合，几乎所有的操作都统一由 ViewController 包办。
> * 中间层的设计是两种架构的核心差异：从逻辑上讲，中间层的作用就是连接视图层和模型层。它用于处理交互、接收通知和完成数据更新。
>   * MVC 的中间层 Controller 持有视图和模型，主要起到组装和连接的作用，通过传递参数和实例变量来直接完成所有操作。
>   * MVVM 的中间层 viewModel 持有模型，在更新模型上与 MVC 相同。它独立于视图，视图拥有中间层，通过绑定属性自动更新。
> * MVC 的耦合度很高，维护和扩展成本最高，但是因为无须层级传递，所以代码总量较小
> * MVVM 的耦合度角度，比较容易实现高测试覆盖率。

### 3、什么是单例？及优缺点

> 单例就是一个类只被实例化一次，提供对唯一实例的受控访问

> 优点：一个类只被实例化一次，提供唯一的实例受控访问，节省系统资源，允许可变数目的实例
>
> 
>
> 缺点：一个类只有一个对象，可能造成责任过重，在一定程度上违背了单一职责的原则；单例模式中没有抽象层，因此单例扩展有很大困难；滥用单例模式将带来一些负面问题，比如：实例化对象长时间不被利用，系统会认为是垃圾而被回收，导致对象状态丢失。

### 4、创建单例有哪两种方式？

> 1. 创建一个全局静态实例并置为 nil；实现一个实例构造方法并同步处理，再判断上面声明的静态实例是否为 nil，如果是则新建并返回这个实例对象；
> 2. 使用 GCD 线程中只执行一次的方法来创建单例。

### 5、用伪代码写一个线程安全的单例模式

```objc
static id _instance;

+ (id)allocWithZone:(struct _NSZone *)zone {
  static dispatch_once_t onceToken;
  dispatch_once(&onceToken, ^{
    _instance = [super allocWithZone:zone];
  });
  return _instance;
}

+ (instancetype)sharedData {
  static dispatch_once_t onceToken;
  dispatch_once(&onceToken, ^{
    _instance = [[self alloc] init];
  });
    return _instance;
}

- (id)copyWithZone:(NSZone *)zone {
  return _instance;
}
```